<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
<html xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="utf-8"/>
    <title>Список записей</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"></script>
    <style>
        .image-frame {
            /*border: 1px solid #ccc;*/
            border-radius: 5px;
            padding: 0;
            margin: auto;
            width: auto;
            height: auto;
            box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2);
        }
    </style>
</head>

<body>
<div th:replace="~{navigation :: navi('Home')}"></div>
<div style="margin-left: 50px;margin-right: 50px">
    <div style="width: 750px" class="container">
        <div id="postList">
            <div th:each="post : ${posts}" style="background: #f3f3f3" class="card mb-3">
                <div class="card-header">
                    <h5 class="card-title" th:text="${post.getUser().getUsername()}"></h5>
                    <p class="card-text text-muted" th:text="${post.getCreatedAt()}"></p>
                </div>
                <div class="card-body">
                    <p class="card-header" style="font-size: 1.5rem;" th:text="${post.getPostText()}"></p>
                    <div  style="display: flex"  class="image-frame" th:each="image : ${post.getImages()}"  >
                        <img style="padding: 15px; margin: auto; max-height: 600px; border-radius: 25px; " class="img-fluid" th:src="@{'data:image/;base64,'+${image.ConvertBytesToBase64()}}"
                             alt="Post Image" />
                    </div>
                </div>
                <div style="color: white" class="card-footer ">
                    <a th:href="@{'/posts/show/' + ${post.getPostId()}}" class="btn btn-dark">Просмотреть</a>
                    <a th:if="${#authorization.expression('hasRole(''ADMIN'')') || post.user.getUsername() == #authorization.authentication.getName()}"
                       th:href="@{'/posts/addOrUpdate/edit/' + ${post.getPostId()}}"
                       class="btn btn-dark">Редактировать</a>
                    <a th:if="${#authorization.expression('hasRole(''ADMIN'')') || post.user.getUsername() == #authorization.authentication.getName()}"
                       th:href="@{'/posts/delete/' + ${post.getPostId()}}" class="btn btn-dark">Удалить</a>
                </div>
            </div>
        </div>

        <button style="margin-bottom: 80px; height: 60px" class="container btn btn-dark " id="loadMoreBtn" th:if="${!posts.isEmpty()}" onclick="loadMorePosts()">Загрузить еще</button>
        <script th:inline="javascript">
            var nextPage = 1;
            function loadMorePosts() {
                const url = '/?page=' + nextPage;

                $.get(url, function(data) {
                    $('#postList').append($(data).find('#postList').html());
                });
                nextPage++;
            }
        </script>
<!--        <div id="load-more-section" >-->
<!--            <a th:href="@{/(page=${page + 1})}" class="btn btn-primary" id="load-more-button">Загрузить еще</a>-->
<!--        </div>-->
<!--        <nav aria-label="Page navigation" th:if="${totalPages > 0}">-->
<!--            <ul class="pagination">-->
<!--                <li class="page-item" th:each="i : ${#numbers.sequence(0, totalPages - 1)}">-->
<!--                    <a class="page-link" th:href="@{${filterUrl}(page=${i})}" th:text="${i + 1}"></a>-->
<!--                </li>-->
<!--            </ul>-->
<!--        </nav>-->
    </div>
</div>
</body>